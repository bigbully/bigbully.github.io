---
layout: post
title: å‡½æ•°å¼ç¼–ç¨‹scalaç¬¬å››ç« 
description: 
category: scala
---

ä¸ä¾èµ–å¼‚å¸¸æ¥å¤„ç†é”™è¯¯
====


4.1ä»‹ç»
----

åœ¨ç¬¬ä¸€ç« é‡Œæˆ‘ä»¬è®²æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ä¼šæ‰“ç ´å¼•ç”¨é€æ˜ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

	def failingFn(i: Int): Int = {
	  val x: Int = throw new Exception("fail!")
	  try {
		val y = 42 + 5
		x+ y 
	  }
	  catch { case e: Exception => 43 }
	}

ä¸è¡¨è¾¾å¼42 + 5äº§ç”Ÿçš„ç»“æœä¸º47ä¸åŒï¼Œè¡¨è¾¾å¼throw new Exception("fail!")ä¸äº§ç”Ÿä¸€ä¸ªå€¼------å…¶â€œç»“æœâ€æ˜¯è·³åˆ°æœ€è¿‘çš„catchï¼Œè¿™å–å†³äºä¸Šä¸‹æ–‡ä¸­å®ƒæ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚ä½¿ç”¨throwå’Œcatchæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½åœ¨å•çº¯çš„ä½¿ç”¨å®šä¹‰æ›¿æ¢å˜é‡æ¥æ¨å€’æˆ‘ä»¬çš„ç¨‹åº------å¦‚æœæˆ‘ä»¬æŠŠx + yä¸­çš„xç”¨throw new Exception("fail!")æ›¿æ¢ï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚

é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ç¼–å†™ç¨‹åºæ¥å¤„ç†é”™è¯¯å‘¢ï¼Ÿè¿™å°†æ˜¯ä½ åœ¨æœ¬ç« ä¸­å­¦åˆ°çš„ã€‚è¯¥æŠ€æœ¯åŸºäºä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼šä¸å…¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œæˆ‘ä»¬ä¸å¦‚è¿”å›ä¸€ä¸ªå€¼ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå¼‚å¸¸å‘ç”Ÿçš„åœºæ™¯ã€‚è¿™ä¸ªæƒ³æ³•å¯èƒ½é‚£äº›åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨è¿”å›ç æ¥å¤„ç†è¿‡å¼‚å¸¸çš„äººä¼šæœ‰äº›ç†Ÿæ‚‰ï¼Œè™½ç„¶åœ¨FPä¸­å®ƒçš„å¤„ç†æ–¹å¼æœ‰äº›è®¸ä¸åŒï¼Œæˆ‘ä»¬ä¸€ä¼šå„¿å°±ä¼šçœ‹åˆ°ã€‚
	
4.2å¯èƒ½çš„æ›¿ä»£æ–¹æ¡ˆ
----

è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªæ›´ç°å®çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶å¯»æ‰¾ä¸åŒçš„æ–¹æ³•æ¥æ›¿ä»£ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªå‡½æ•°çš„å®ç°ï¼Œå®ƒè®¡ç®—Listçš„å¹³å‡å€¼ï¼Œå¦‚æœåˆ—è¡¨æ˜¯ç©ºçš„è¯ï¼Œåˆ™æ²¡æœ‰ç»“æœï¼š

	def mean(xs: Seq[Double]): Double = //1
	  if (xs.isEmpty)
	    throw new ArithmeticException("mean of empty list!")
	  else xs.sum / xs.length  //2


ï¿¼

 1. Seqæ˜¯å„ç§çº¿æ€§åºåˆ—ç±»å‹é›†åˆçš„å¸¸è§æ¥å£ã€‚æŸ¥çœ‹APIæ–‡æ¡£è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚
 2. Seqä¸­çš„sumæ–¹æ³•ä½¿ç”¨äº†ä¸€äº›é­”æ³•ï¼ˆæˆ‘ä»¬ä¸ä¼šåˆ°è¿™é‡Œè®¨è®ºï¼‰ï¼Œä½¿å¾—è¯¥æ–¹æ³•åªæœ‰åªå¯¹æ•°å­—ç±»å‹çš„å…ƒç´ èµ·ä½œç”¨ã€‚


meanå‡½æ•°æ˜¯*åå‡½æ•°*æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¯¹äºæŸäº›è¾“å…¥å®ƒæ²¡æœ‰å®šä¹‰ã€‚å‡½æ•°é€šå¸¸éƒ½æ˜¯åå‡½æ•°ï¼Œå› ä¸ºå®ƒå¯¹è¿™äº›è¾“å…¥åšäº†ä¸€äº›è¾“å…¥é™¤ç±»å‹ä¹‹å¤–çš„å‡è®¾[^footnote1]ã€‚ä½ å¯èƒ½ä¼šåœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æˆ‘ä»¬æœ‰ä¸€äº›å…¶ä»–çš„é€‰æ‹©ã€‚è®©æˆ‘ä»¬æ¥é‡æ–°å®¡è§†ä¸€ä¸‹æˆ‘ä»¬çš„meanå‡½æ•°ï¼š

[^footnote1]:ä¸€ä¸ªå‡½æ•°å³ä¾¿å¯¹äºæŸäº›è¾“å…¥æ°¸è¿œä¸ä¼šæ‰§è¡Œå®Œæˆï¼Œä½†å®ƒä¹Ÿå¯èƒ½æ˜¯åå‡½æ•°ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºè¿™ç§å½¢å¼çš„åå‡½æ•°------å¦‚æœä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºæ˜¯æ— æ³•ä»è¿™ç§æ°¸ä¸åœæ­¢çš„çŠ¶æ€ä¸­å›å¤ï¼Œæˆ–æ˜¯æ— æ³•ä»å†…éƒ¨æ£€æµ‹å®ƒçš„è¿è¡ŒçŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶æ²¡æœ‰ä»»ä½•å¥½çš„åŠæ³•å»åº”å¯¹å®ƒã€‚

ç¬¬ä¸€ç§å¯èƒ½æ˜¯è¿”å›æŸç§Doubleç±»å‹çš„å‡å€¼ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰æƒ…å†µä¸­ç®€å•åœ°è¿”å›xs.sum / xs.lengthï¼Œä½†å½“è¾“å…¥æ˜¯ç©ºSeqæ—¶ä¼šå¯¼è‡´0ï¼0ï¼Œå®ƒçš„ç»“æœæ˜¯double.NaNï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥è¿”å›ä¸€äº›å…¶ä»–çš„å“¨å…µå€¼ï¼ˆsentinel valueï¼‰ã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½è¿”å›nullè€Œä¸æ˜¯ä¸€ä¸ªæ‰€éœ€ç±»å‹çš„å€¼ã€‚ä½†æˆ‘ä»¬æ‹’ç»äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼ŒåŸºäºä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

 - å®ƒå…è®¸é”™è¯¯æ— å£°åœ°ä¼ æ’­ï¼Œè°ƒç”¨è€…å¯ä»¥å¿˜è®°æ£€æŸ¥è¿™ç§æƒ…å†µï¼Œè€Œç¼–è¾‘å™¨ä¹Ÿä¸ä¼šé€šçŸ¥è°ƒç”¨è€…ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åœ¨éšåçš„ä»£ç ä¸æ­£å¸¸å·¥ä½œã€‚é”™è¯¯çš„å‘ç”Ÿé€šå¸¸ä¼šåœ¨å¾ˆåé¢çš„ä»£ç ä¸­æ‰ä¼šè¢«æ£€æµ‹åˆ°ã€‚
 - å®ƒä¸é€‚ç”¨äºå¤šæ€ä»£ç ã€‚å¯¹äºæŸäº›è¾“å‡ºç±»å‹ï¼Œå³ä½¿æˆ‘ä»¬æƒ³è®¾ç½®è¯¥ç±»å‹çš„å“¨å…µå€¼ï¼Œæˆ‘ä»¬ç”šè‡³éƒ½æ²¡æœ‰è¿™ç§å€¼ï¼è€ƒè™‘ä¸€ä¸ªåƒmaxè¿™ç§æ‰¾åˆ°åºåˆ—ä¸­æœ€å¤§å€¼çš„å‡½æ•°å§ï¼Œå®ƒä¼šæ ¹æ®ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°æ¥åˆ¤æ–­å¤§å°ï¼šdef[A] (xs:Seq[A])(greater:(A, A) => Boolean): Aã€‚å¦‚æœè¾“å…¥çš„æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬æ²¡åŠæ³•åˆ›é€ ä¸€ä¸ªAçš„å€¼ã€‚nullä¹Ÿä¸å¯èƒ½ç”¨åœ¨è¿™é‡Œï¼Œå› ä¸ºnullåªå¯¹ä¸€ä¸ªéåŸºç¡€ç±»å‹æœ‰æ•ˆï¼Œè€ŒAç±»å‹åœ¨æ–¹æ³•ç­¾åä¸­å®Œå…¨æ²¡æœ‰è¢«é™åˆ¶ã€‚
 - å®ƒéœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç­–ç•¥ï¼Œæˆ–æ˜¯è°ƒç”¨æ–¹çš„è°ƒç”¨çº¦å®š------ä½ è¦æƒ³é€‚å½“çš„ä½¿ç”¨meanå‡½æ•°ï¼Œè¦æ±‚è°ƒç”¨æ–¹é™¤äº†ç®€å•çš„è°ƒç”¨meanå‡½æ•°è·å¾—ç»“æœä¹‹å¤–è¿˜è¦åšäº›å…¶ä»–å¤„ç†ã€‚åƒè¿™æ ·å¯¹å‡½æ•°è¦æ±‚ç‰¹æ®Šçš„ç­–ç•¥ä½¿å¾—å¾ˆéš¾æŠŠå®ƒä»¬ä¼ é€’åˆ°é«˜é˜¶å‡½æ•°ï¼Œé«˜é˜¶å‡½æ•°å¿…é¡»å¯¹æ‰€æœ‰å®ƒä»¬æ¥æ”¶çš„å‡½æ•°ä»…ä»…ä½œä¸ºå‚æ•°ä¹‹ä¸€ï¼Œä¸€è‡´å¯¹å¾…ï¼Œå¹¶ä¸”é€šå¸¸åªçŸ¥é“è¿™äº›å‡½æ•°çš„ç±»å‹ï¼Œè€Œä¸æ˜¯ä»»ä½•ç‰¹æ®Šçš„ç­–ç•¥æˆ–è°ƒç”¨çº¦å®šã€‚

ç¬¬äºŒç§å¯èƒ½æ˜¯å¼ºåˆ¶è°ƒç”¨è€…æä¾›ä¸€ä¸ªå‚æ•°ï¼Œå®ƒåœ¨æˆ‘ä»¬åœ¨æ— æ³•åº”å¯¹çš„åœºæ™¯æ—¶å‘Šè¯‰æˆ‘ä»¬è¯¥æ€æ ·åšï¼š

	def mean_1(xs: IndexedSeq[Double], onEmpty: Double): Double =
	  if (xs.isEmpty) onEmpty
	  else xs.sum / xs.length

è¿™ä½¿meanç¼–ç¨‹å®Œæ•´çš„å‡½æ•°ï¼Œä½†å®ƒä¹Ÿæœ‰ç¼ºç‚¹------å®ƒéœ€è¦ç›´æ¥è°ƒç”¨è€…çš„æ¸…æ¥šå¦‚ä½•å¤„ç†meanå‡½æ•°æœªå®šä¹‰çš„æƒ…å†µï¼ŒæŠŠé™åˆ¶è¿™ç§æƒ…å†µè¿”å›ä¸€ä¸ªDoubleå€¼ã€‚å¦‚æœmeanæ˜¯åœ¨ä¸€ä¸ªå¤§å‹è®¡ç®—é€»è¾‘ä¸­çš„ä¸€éƒ¨åˆ†è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›å½“meanå¤„ç†çš„æƒ…å†µæœªå®šä¹‰çš„èŠ±ï¼Œå°±ä¸­æ­¢ç¨‹åºå‘¢ï¼Ÿæˆ–è®¸æˆ‘ä»¬æƒ³åœ¨è¿™ç§æƒ…å†µä¸‹é‡‡ç”¨å¤§å‹è®¡ç®—é€»è¾‘ä¸­çš„å¦ä¸€ä¸ªå®Œå…¨ä¸åŒçš„é€»è¾‘åˆ†æ”¯å‘¢ï¼Ÿåªæ˜¯ç®€å•çš„ä¼ å…¥ä¸€ä¸ªonEmptyå‚æ•°å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬è¿™ç§è‡ªç”±ã€‚

æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å»æ¨è¿Ÿåšå‡ºå¦‚ä½•å¤„ç†è¿™ç§æœªå®šä¹‰æƒ…å†µçš„å†³å®šï¼Œæ¥è®©æˆ‘ä»¬åœ¨ä½•æ—¶çš„å±‚é¢ä¸Šå¤„ç†è¿™ç§æƒ…å†µã€‚

4.3Optionæ•°æ®ç±»å‹
----

è¯¥è§£å†³æ–¹æ¡ˆæ˜¯åœ¨è¿”å›ç±»å‹ä¸­æ˜ç¡®è¡¨ç¤ºï¼šæˆ‘ä»¬å¯èƒ½ä¸æ€»æ˜¯è¿”å›ä¸€ä¸ªæ˜ç¡®çš„å€¼ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™ç§æ–¹æ¡ˆæ¨è¿Ÿäº†è°ƒç”¨è€…åšå¯¹é”™è¯¯å¤„ç†çš„ç­–ç•¥ã€‚æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„ç±»å‹ï¼ŒOptionï¼š

	sealed trait Option[+A]
	case class Some[+A](get: A) extends Option[A]
	case object None extends Option[Nothing]

Optionæœ‰ä¸¤ä¸ªCaseç±»ï¼šå®ƒå¯ä»¥è¢«å®šä¹‰ï¼Œè¿™ç§Caseç±»ä¸ºSomeï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä¸è¢«å®šä¹‰ï¼Œå³Noneã€‚æˆ‘ä»¬ä½¿ç”¨Optionæ¥å®ç°meanå‡½æ•°çš„å®šä¹‰ï¼š

	def mean(xs: Seq[Double]): Option[Double] =
	  if (xs.isEmpty) None
	  else Some(xs.sum / xs.length)

è¿”å›ç±»å‹ç°åœ¨åæ˜ äº†meançš„ç»“æœä¸æ€»æ˜¯æ˜ç¡®çš„ã€‚æˆ‘ä»¬ä»ç„¶ä¼šä¸ºæˆ‘ä»¬çš„å‡½æ•°è¿”å›ä¸€ä¸ªå£°æ˜ç±»å‹çš„ç»“æœï¼ˆç°åœ¨æ˜¯Option[Double]ï¼‰ï¼Œæ‰€ä»¥meanç°åœ¨æ˜¯ä¸€ä¸ª*å®Œæ•´çš„å‡½æ•°*äº†ã€‚å®ƒå°†æ¯ä¸€ä¸ªè¾“å…¥ç±»å‹éƒ½è½¬åŒ–æˆç¡®å®šçš„è¾“å‡ºç±»å‹çš„å€¼ã€‚

4.3.1Optionä½¿ç”¨æ¨¡å¼åŒ¹é…
----
åœ¨ç¨‹åºè®¾è®¡ä¸­çš„åå‡½æ•°å¤§é‡å­˜åœ¨ï¼ŒOptionï¼ˆæˆ‘ä»¬ç¨åä¼šè®¨è®ºå®ƒç›¸å…³çš„æ•°æ®ç±»å‹ï¼‰æ˜¯å…¸å‹çš„FPçš„æ–¹å¼å¤„ç†åå‡½æ•°ã€‚ä½ ä¼šçœ‹åˆ°åœ¨éåŠScalaæ ‡å‡†åº“ä¸­ä½¿ç”¨çš„Optionï¼Œä¾‹å¦‚ï¼š

 - [Mapåœ¨æŸ¥æ‰¾ç»™å®šçš„Key](http://www.scala-lang.org/api/current/index.html#scala.collection.Map)æ—¶è¿”å›Option
 - headOptionå’ŒlastOption åœ¨[Listæˆ–å…¶ä»–Iterable](http://www.scala-lang.org/api/current/index.html#scala.collection.immutable.List)ä¸­è¿”å›Optionï¼Œå½“Sequenceä¸ä¸ºç©ºæ—¶ï¼Œç»“æœåŒ…å«Sequenceä¸­ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå…ƒç´ ã€‚

è¿™å¹¶ä¸æ˜¯å”¯ä¸€çš„ä¾‹å­------æˆ‘ä»¬ä¼šçœ‹åˆ°Optionåœ¨ä¸åŒæƒ…å†µæ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚Optionä¸ºä»€ä¹ˆè¿™ä¹ˆæ–¹ä¾¿ï¼Œæ˜¯å› ä¸ºå¯ä»¥è®©æˆ‘ä»¬é€šè¿‡é«˜é˜¶å‡½æ•°æ¥æç‚¼å‡ºé”™è¯¯å¤„ç†çš„é€šç”¨æ¨¡å¼ï¼Œè®©æˆ‘ä»¬ä»å…¬å¼åŒ–çš„ç¼–å†™å¼‚å¸¸å¤„ç†æ ·æ¿çš„ä»£ç ä¸­è§£æ”¾å‡ºæ¥ã€‚

Optionå¯ä»¥è®¤ä¸ºæ˜¯æœ€å¤šåªèƒ½åŒ…å«ä¸€ä¸ªå…ƒç´ çš„Listï¼Œæˆ‘ä»¬çœ‹åˆ°çš„è®¸å¤šListçš„å‡½æ•°åœ¨Optionä¸Šéƒ½æœ‰ç±»ä¼¼çš„å‡½æ•°ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™äº›å‡½æ•°ã€‚æˆ‘ä»¬å°†åšä¸€äº›ç¨å¾®ä¸åŒäºä¸Šä¸€ç« çš„äº‹ã€‚åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æ“ä½œListå¯¹è±¡çš„å‡½æ•°éƒ½æ”¾åœ¨Listçš„ä¼´ç”Ÿå¯¹è±¡ä¸­ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠæˆ‘ä»¬çš„å‡½æ•°ï¼Œå°½å¯èƒ½çš„æ”¾åœ¨Option traité‡Œé¢ï¼Œæ‰€ä»¥ä»–ä»¬å¯ä»¥ç”¨OOçš„è¯­æ³•è°ƒç”¨ï¼ˆobj.fn(arg1) æˆ–è€… obj fn arg1è€Œä¸æ˜¯fn(obj, arg1) ï¼‰rg1ï¼‰ï¼‰ã€‚è¿™åªæ˜¯ä¸ªé£æ ¼ä¸Šçš„é€‰æ‹©ï¼Œå¹¶ä¸æ˜¯è¯´é‚£ç§é£æ ¼æ›´å¥½ï¼Œæˆ‘ä»¬å°†åœ¨è¿™æœ¬ä¹¦ä¸­åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§é£æ ¼[footnote2]ã€‚

[footnote2]:ä¸€èˆ¬æ¥è¯´ï¼Œå½“å‡½æ•°æœ‰å•ä¸€ï¼Œæ¸…æ™°çš„æ“ä½œå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨OOé£æ ¼ï¼ˆæ¯”å¦‚List.mapï¼‰ï¼Œå…¶ä»–æƒ…å†µæˆ‘ä»¬ä¼šä½¿ç”¨ç‹¬ç«‹çš„å‡½æ•°å¼é£æ ¼ã€‚


	trait Option[+A] {
	  def map[B](f: A => B): Option[B]
	  def flatMap[B](f: A => Option[B]): Option[B]
	  def getOrElse[B >: A](default: => B): B
	  def orElse[B >: A](ob: => Option[B]): Option[B]
	  def filter(f: A => Boolean): Option[A]
	}

è¿™é‡Œæœ‰ä¸€äº›æ–°ç”Ÿäº‹ç‰©ã€‚getOrElseä¸­defaultï¼š= > Bç±»å‹æ³¨é‡Šï¼ˆä»¥åŠorElseå‡½æ•°ä¸­åŒæ ·çš„æ ‡æ³¨ï¼‰è¡¨ç¤ºè¿™ä¸ªå‚æ•°å°†ä¸ä¼šè¢«è¿è¡Œé™¤éå‡½æ•°éœ€è¦ä½¿ç”¨å®ƒã€‚ç°åœ¨å…ˆä¸è¦æ‹…å¿ƒ------æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­è¿›ä¸€æ­¥è®¨è®ºå®ƒã€‚å¦å¤–ï¼ŒB >: A è¿™ä¸ªå‡½æ•°çš„ç±»å‹å‚æ•°è¡¨ç¤ºBå¿…é¡»æ˜¯ä¸€ä¸ªAçš„*è¶…ç±»*ï¼ˆsupertypeï¼‰ã€‚è¿™æ˜¯ä¸ºäº†è®©Scalaç¼–è¾‘å™¨ä¿¡æœOption[+A]å¯¹äºAçš„åå˜æ˜¯å®‰å…¨çš„ï¼ˆç¼–è¯‘å™¨ä¼šå‡å®šOption[Dog]æ˜¯Option[Animal]çš„å­ç±»ï¼‰ã€‚å¯¹äºorElseå‡½æ•°åŒç†ã€‚å¯¹äºå½“å‰æˆ‘ä»¬çš„ç›®æ ‡æ¥è¯´ï¼Œè¿™å¹¶ä¸é‡è¦ï¼›OOé£æ ¼çš„é‡è¦ç‚¹æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œå¯¹è±¡çš„å‡½æ•°æ”¾ç½®åœ¨traitä¸­ã€‚

ç»ƒä¹ 1ï¼šæˆ‘ä»¬ä¼šåœ¨ä¹‹åæ¢ç©¶è¿™äº›å‡½æ•°ã€‚ä½†é¦–å…ˆï¼Œä½œä¸ºç»ƒä¹ ï¼Œå®ç°ä¸Šè¿°æ‰€æœ‰Optionçš„å‡½æ•°ã€‚å½“ä½ å®ç°æ¯ä¸ªå‡½æ•°æ—¶ï¼Œè¯•ç€å»æ€è€ƒå®ƒçš„æ„ä¹‰ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½ ä¼šä½¿ç”¨å®ƒä»¬ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æç¤ºï¼š

 - ä½ å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼Œè™½ç„¶ä½ åº”è¯¥ä¸å€ŸåŠ©æ¨¡å¼åŒ¹é…å®ç°é™¤äº†mapå’ŒgetOrElseä¹‹å¤–çš„æ‰€æœ‰å‡½æ•°ã€‚(ä¸åç»­ç« èŠ‚ç›¸å…³ï¼Œéå¸¸é‡è¦)
 - å¯¹äºmapå’ŒflatMapï¼Œç±»å‹ç­¾åå°±è¶³å¤Ÿå†³å®šå®ƒæ˜¯æ€æ ·å®ç°çš„
 - getOrElseä¼šè¿”å›Some Caseç±»ä¸­åŒ…å«çš„ç»“æœï¼Œå½“Optionæ˜¯Noneæ—¶ï¼Œè¿”å›ç»™å®šçš„é»˜è®¤å€¼
 - å½“Optionæ˜¯è¢«å®šä¹‰çš„ï¼ŒorElseå‡½æ•°ä¼šè¿”å›å½“å‰å¯¹è±¡ï¼Œå¦åˆ™ï¼Œè¿”å›ç»™å®šçš„Option[B]

è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨Optionä¸Šæ˜¾å¼çš„ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼Œä½†æˆ‘ä»¬å‡ ä¹æ€»æ˜¯ä½¿ç”¨ä¸Šè¿°é«˜é˜¶å‡½æ•°ã€‚å…³äºä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä»–ä»¬ï¼Œæˆ‘ä»¬ä¼šå°½å¯èƒ½çš„ç»™å‡ºæŒ‡å¯¼æ„è§ï¼Œæ‰€ä»¥å¦‚æœç°åœ¨è¿˜ä¸å®Œå…¨æ¸…æ¥šä¹Ÿä¸è¦æ‹…å¿ƒã€‚è¿™é‡Œçš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†åŸºæœ¬ç†Ÿæ‚‰ä¸€ä¸‹ï¼Œå½“ä½ å¼€å§‹å†™æ›´å¤šçš„å‡½æ•°æ˜¯ä»£ç æ—¶å°±ä½ å¯ä»¥è¯†åˆ«è¿™äº›æ¨¡å¼ã€‚

mapå‡½æ•°å¯ä»¥ç”¨æ¥æŠŠOptionä¸­çš„ç»“æœè¿›è¡Œè½¬åŒ–ï¼Œå¦‚æœå®ƒå­˜åœ¨çš„è¯ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨å‡è®¾æ²¡æœ‰å‘ç”Ÿé”™è¯¯æ—¶è¿›è¡Œçš„è®¡ç®—------è¿™ä¹Ÿæ˜¯ä¸€ç§å»¶è¿Ÿçš„é”™è¯¯å¤„ç†çš„æ–¹å¼ï¼š

	case class Employee(name: String, department: String)
	
	val employeesByName: Map[String, Employee] = //1
	  List(Employee("Alice", "R&D"), Employee("Bob", "Accounting")).map(e => (e.name, e)).toMap //2
	  
	val dept: Option[String] = employeesByName.get("Joe").map(_.dept)

 1. ä»¥Stringä¸ºé”®å’ŒEmployeeä¸ºå€¼çš„å­—å…¸æˆ–å…³è”å®¹å™¨
 2. æŠŠList[(A, B)]è½¬åŒ–æˆMap[A, B]çš„å¿«æ·æ–¹æ³•

åœ¨è¿™é‡Œï¼ŒemployeesByName.getè¿”å›ä¸€ä¸ªOption[Employee]ï¼Œæˆ‘ä»¬ä½¿ç”¨mapæ¥è½¬æ¢ï¼Œå®ƒè¿”å›ä¸€ä¸ªOption[String]ä»£è¡¨å‘˜å·¥æ‰€å±çš„éƒ¨é—¨ã€‚

flatMapå’Œmapç±»ä¼¼ï¼Œä½†å®ƒæä¾›äº†ä¸€ç§ç»“æœå¯ä»¥å¤±è´¥çš„è½¬æ¢ã€‚

ç»ƒä¹ 2ï¼šå®ç°æ–¹å·®varianceå‡½æ•°ï¼ˆå‡å¦‚å¹³å‡æ•°æ˜¯mï¼Œvarianceæ˜¯math.pow(x - m, 2)ï¼‰ï¼Œä½¿ç”¨meanå’ŒflatMap[^footnote3]ã€‚

[^footnote3]: æ–¹å·®Varianceå¯ä»¥åœ¨ä¸€ä¸ªä¼ é€’ä¸­è¢«è®¡ç®—ï¼Œä½†å¤„äºæ•™å­¦ç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨2æ¬¡ä¼ é€’æ¥è®¡ç®—å®ƒã€‚é¦–å…ˆè®¡ç®—æ•°æ®é›†çš„å¹³å‡å€¼ï¼Œç„¶åè®¡ç®—å‡ºå¹³å‡å€¼çš„å¹³æ–¹å·®ã€‚


	ï¿¼def variance(xs: Seq[Double]): Option[Double]

filterå¯ä»¥æŠŠæˆåŠŸçš„å€¼è½¬æ¢ä¸ºå¤±è´¥ï¼Œå¦‚æœæˆåŠŸçš„å€¼ä¸åŒ¹é…ç»™å®šçš„æ–­è¨€ã€‚ä¸€ä¸ªå¸¸è§çš„æ¨¡å¼æ˜¯å°†Optionï¼Œé€šè¿‡è°ƒç”¨mapï¼ŒflatMapï¼Œå’Œ/æˆ–filterï¼Œç„¶åä½¿ç”¨getOrElseåœ¨æœ€åå¤„ç†é”™è¯¯ã€‚


	val dept: String =
	  employeesByName.get("Joe").
	  map(_.dept).
	  filter(_ != "Accounting").
	  getOrElse("Default Dept")

åœ¨è¿™é‡Œä½¿ç”¨getOrElseæ˜¯ä¸ºäº†æŠŠOption[String]è½¬åŒ–æˆStringï¼Œå½“é”®"Joe"åœ¨Mapä¸­ä¸å­˜çš„æ—¶å€™ï¼Œæˆ–è€…"Joe"çš„éƒ¨é—¨åæ˜¯"Accounting"æ—¶ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„éƒ¨é—¨åã€‚

å¸¸è§çš„ç”¨æ³•æ˜¯åšo.getOrElse(throw AnException("FAIL")) æ¥æŠŠNoneè½¬åŒ–æˆä¸€ä¸ªå¼‚å¸¸ã€‚ä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œåªæœ‰åœ¨æ²¡æœ‰åˆç†çš„ç¨‹åºèƒ½å¤Ÿæ•æ‰åˆ°å¼‚å¸¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰ä¼šæŠ›å‡ºå¼‚å¸¸------å¦‚æœå¯¹æŸäº›è°ƒç”¨æ–¹è€Œè¨€å¼‚å¸¸ä¹Ÿè®¸æ˜¯å¯æ¢å¤çš„é”™è¯¯æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨Optionæ¥ç»™äºˆå®ƒä»¬çµæ´»æ€§ã€‚

4.3.2Optionçš„ç»„åˆå’Œæå‡
---
è¿™å¯èƒ½æ˜¯å®¹æ˜“å¾—å‡ºçš„ç»“è®ºï¼šä¸€æ—¦æˆ‘ä»¬å¼€å§‹ä½¿ç”¨Optionï¼Œå®ƒä¼šæ„ŸæŸ“æˆ‘ä»¬çš„æ•´ä¸ªä»£ç åŸºç¡€ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œä»»ä½•ä¸€ä¸ªæ¥æ”¶æˆ–è¿”å›Optionçš„æ–¹æ³•çš„è°ƒç”¨æ–¹å°†ä¸å¾—ä¸ä¿®æ”¹é€»è¾‘æ¥å¤„ç†Someæˆ–Noneã€‚ä½†è¿™æ ¹æœ¬ä¸å¯èƒ½å‘ç”Ÿï¼Œè€ŒåŸå› åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥å°†æ™®é€šå‡½æ•°*æå‡*ä¸ºæ“ä½œOptionçš„å‡½æ•°ã€‚

ä¾‹å¦‚ï¼Œmapå‡½æ•°å¯ä»¥è®©æˆ‘ä»¬æ“ä½œç±»å‹Option[A]ï¼Œä½¿ç”¨A => Bç±»å‹çš„å‡½æ•°ï¼Œè¿”å›Option[B]ã€‚å¦ä¸€ç§çœ‹å¾…è¿™ä¸ªé—®é¢˜çš„æ–¹å¼æ˜¯ï¼šmapæŠŠä¸€ä¸ªA => Bç±»å‹çš„å‡½æ•°è½¬åŒ–æˆOption[A] => Option[B]ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜ç¡®çš„ç±»å‹ç­¾åä¼šçœ‹çš„æ›´æ¸…æ™°ä¸€äº›ï¼š

	ï¿¼def lift[A,B](f: A => B): Option[A] => Option[B] = _ map f

ä½œä¸ºä½ æ˜¯ç”¨mapçš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬æ¥å†çœ‹ä¸€ä¸ªè¿”å›Optionçš„å‡½æ•°çš„ä¾‹å­ï¼š

	import java.util.regex._
	def pattern(s: String): Option[Pattern] =
	  try {
	    Some(Pattern.compile(s))
	  } catch {
	    case e: PatternSyntaxException => None
	  }


è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†Javaæ ‡å‡†åº“ä¸­çš„regexåŒ…ï¼Œæ¥æŠŠä¸€ä¸ªStringè§£ææˆæ­£åˆ™è¡¨è¾¾å¼[^footnote4]ã€‚å¦‚æœè¿™ä¸ªStringä¸­æœ‰æ­£åˆ™æ¨¡å¼çš„è¯­æ³•é”™è¯¯ï¼ˆè¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼Œæˆ‘ä»¬ä¼šæ•æ‰åˆ°åº“å‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶è¿”å›Noneã€‚åœ¨Patternç±»çš„æ–¹æ³•ä¸éœ€è¦çŸ¥é“å…³äºOptionçš„ä»»ä½•ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mapå‡½æ•°ç®€å•åœ°*æå‡*ï¼ˆliftï¼‰ä»–ä»¬ï¼š


	def mkMatcher(pat: String): Option[String => Boolean] =
  pattern(pat) map (p => (s: String) => p.matcher(s).matches) //1

 1. è¿™ä¸ªAPIç»†èŠ‚å¹¶ä¸å¤ªé‡è¦ï¼Œä¸è¿‡p.matcher(s).matchesä¼šæ£€æŸ¥Stringæ˜¯å¦åŒ¹é…æ¨¡å¼p.


[^footnote4]:Scalaè¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šä¸æ‰€æœ‰ç°æœ‰çš„Javaåº“å®Œå…¨å…¼å®¹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åƒä»»ä½•Scalaå‡½æ•°ä¸€æ ·è°ƒç”¨Pattern.compileï¼Œè¿™ä¸ªJavaå‡½æ•°ã€‚


åœ¨è¿™é‡Œï¼Œpattern(pat)è°ƒç”¨å°†è¿”å›ä¸€ä¸ªOption[Pattern]ï¼Œå¦‚æœpatæ˜¯æ— æ•ˆçš„åˆ™è¿”å›Noneã€‚æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨map*å†…*ä½¿ç”¨matcherå’Œmatcheså‡½æ•°çš„ã€‚æ­£å› ä¸ºä»–ä»¬åœ¨mapå†…éƒ¨ï¼Œä»–ä»¬ä¸éœ€è¦çŸ¥é“å¤–éƒ¨çš„åŒ…è£…å™¨Optionã€‚å¦‚æœä½ è§‰å¾—ä½ è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡å®ƒæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼Œé‚£ä¹ˆä½¿ç”¨æ›¿ä»£æ¨¡å‹åœ¨çº¸ä¸Šä¸€æ­¥ä¸€æ­¥çš„ç”»ä¸€ä¸‹å§ï¼Œè¯•ä¸€è¯•patæ˜¯æœ‰æ•ˆçš„å’Œæ— æ•ˆçš„ä¸¤ç§æƒ…å†µã€‚


é€šè¿‡ä½¿ç”¨for-comprehensionä¹Ÿå¯ä»¥æå‡ä¸€ä¸ªå‡½æ•°ï¼Œfor-comprehensionåœ¨Scalaä¸­æ˜¯ç¼–å†™ä¸€ç³»åˆ—ä½¿mapå’ŒflatMapä¾¿åˆ©çš„è¯­æ³•ã€‚æˆ‘ä»¬è¿…é€Ÿè§£é‡Šä¸€ä¸‹ã€‚é¦–å…ˆï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¾‹å­ï¼š

	def mkMatcher_1(pat: String): Option[String => Boolean] =
	  for {
	    p <- pattern(pat)
	  } yield ((s: String) => p.matcher(s).matches)
	  
	def doesMatch(pat: String, s: String): Option[Boolean] =
	  for {
	    p <- mkMatcher_1(pat)
	  } yield p(s)


åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯æå‡äº†åªå¸¦ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ä½†æœ‰äº›å‡½æ•°æ¥æ”¶ä¸€ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œæˆ‘ä»¬å¸Œæœ›ä¹Ÿèƒ½å¤Ÿæå‡ä»–ä»¬ã€‚for-comprehensionä½¿ä¹‹å˜å¾—ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆä»»ä½•æˆ‘ä»¬æƒ³è¦çš„Optionï¼š

	def bothMatch(pat: String, pat2: String, s: String): Option[Boolean] =
	  for {
	    f <- mkMatcher(pat)
	    g <- mkMatcher(pat2)
	  } yield f(s) && g(s)

ä¸Šæ–‡æ‰€ç¤ºçš„for-comprehensionæ˜¯ä¸€ä¸ªç®€å•çš„è¯­æ³•ç³–ã€‚åœ¨å…¶å†…éƒ¨ï¼ŒScalaä¼šæŠŠå®ƒç¿»è¯‘æˆæ™®é€šçš„å¯¹mapå’ŒflatMapçš„è°ƒç”¨ï¼š

	ï¿¼ï¿¼def bothMatch_1(pat: String, pat2: String, s: String): Option[Boolean] =
	mkMatcher(pat) flatMap (f =>
	mkMatcher(pat2) map     (g =>
	f(s) && g(s)))

ç»ƒä¹ 3ï¼šbothMatchæ˜¯ä¸€ä¸ªæ›´æ³›åŒ–çš„æ¨¡å¼çš„ä¾‹å­ã€‚å†™ä¸€ä¸ªæ³›å‹å‡½æ•°map2ï¼Œå®ƒå¯ä»¥æŠŠä¸¤ä¸ªOptionçš„å€¼é€šè¿‡ä¸€ä¸ªæ¥æ”¶ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°åˆå¹¶èµ·æ¥ã€‚åªè¦æœ‰ä»»ä½•ä¸€ä¸ªOptionçš„å€¼æ˜¯Noneï¼Œè¿”å›å€¼å°±æ˜¯Noneã€‚ä¸‹é¢æ˜¯æ–¹æ³•ç­¾åï¼š

	def map2[A,B,C](a: Option[A], b: Option[B])(f: (A, B) => C): Option[C]

ç»ƒä¹ 4ï¼šä½¿ç”¨map2é‡æ–°å®ç°bothMatchå‡½æ•°ã€‚

	ï¿¼def bothMatch_2(pat1: String, pat2: String, s: String): Option[Boolean]


ç»ƒä¹ 5ï¼šå†™ä¸€ä¸ªå‡½æ•°sequenceï¼Œä»–ä¼šæŠŠä¸€ä¸ªList[Option]åˆå¹¶æˆOption[List]ï¼Œåè€…åŒ…å«çš„è¿™ä¸ªListä¸­æœ‰åŸå§‹Listä¸­æ‰€æœ‰Someçš„å€¼ã€‚å¦‚æœåŸå§‹Listä¸­åŒ…å«å“ªæ€•ä¸€ä¸ªNoneï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›çš„ç»“æœå°±æ˜¯Noneã€‚åä¹‹ç»“æœä¸­åŒ…å«å…¨éƒ¨æ‰€æœ‰Someçš„å€¼ã€‚ä¸‹é¢æ˜¯å‡½æ•°ç­¾åï¼š[^footnote5]


[^footnote5]:è¿™æ˜¯æ¸…æ™°çš„å®ä¾‹åœ¨é¢å‘å¯¹è±¡çš„é£æ ¼ä¸­å´ä¸å¯èƒ½çš„å®šä¹‰å‡ºæ¥ã€‚è¿™ä¸åº”è¯¥æ˜¯ä¸€ä¸ªListçš„æ–¹æ³•ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ä»»ä½•å…³äºOptionçš„ä¿¡æ¯ï¼‰ï¼Œå®ƒåˆä¸åº”è¯¥æ˜¯ä¸€ä¸ªOptionçš„æ–¹æ³•ã€‚


	ï¿¼def sequence[A](a: List[Option[A]]): Option[List[A]]

æœ‰æ—¶æˆ‘ä»¬ä¼šæƒ³ç”¨ä¸€ä¸ªå¯èƒ½å¤±è´¥çš„å‡½æ•°mapåˆ°ä¸€ä¸ªListä¸­ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°å¯¹ä»»ä½•ä¸€ä¸ªå…ƒç´ æ‰§è¡Œè¿”å›Noneï¼Œåˆ™æ•´ä¸ªmapçš„æ‰§è¡Œç»“æœè¿”å›Noneã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªString Listè§£ææˆä¸€ä¸ªPattern Listã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å¯¹mapçš„ç»“æœè¿›è¡Œsequenceï¼š

	def parsePatterns(a: List[String]): Option[List[Pattern]] =
  sequence(a map pattern)

ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå®ç°æœ‰ä¸€ç‚¹ä½æ•ˆï¼Œå› ä¸ºå®ƒä¾¿åˆ©äº†ä¸¤æ¬¡Listã€‚æƒ³è¦ä»¥æŸç§æ–¹å¼å¯¹mapçš„ç»“æœæ‰§è¡Œsequenceæ­£å¥½ä¸è¿™ä¸ªæ³›å‹å‡½æ•°traverseä¸€è‡´ï¼Œtraverseçš„æ–¹æ³•ç­¾åä¸ºï¼š

	ï¿¼ï¿¼def traverse[A, B](a: List[A])(f: A => Option[B]): Option[List[B]]

ç»ƒä¹ 6ï¼šå®ç°è¿™ä¸ªå‡½æ•°ã€‚å®ƒç›´æ¥ä½¿ç”¨äº†mapå’Œsequenceï¼Œä½†æ˜¯å°è¯•æ›´é«˜æ•ˆçš„å®ç°æ–¹å¼ï¼Œå®ƒä»…ä»…ä¾¿åˆ©äº†ä¸€æ¬¡Listã€‚äº‹å®ä¸Šï¼Œsequenceå¯ä»¥ä½¿ç”¨traverseæ¥å®ç°ã€‚


4.3.3Eitheræ•°æ®ç±»å‹
----

æœ¬ç« çš„ä¸»è¦æ€æƒ³æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ™®é€šçš„å€¼æ¥è¡¨ç¤ºå¤±è´¥å’Œå¼‚å¸¸ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç¼–å†™å‡½æ•°æŠ½è±¡å‡ºé”™è¯¯å¤„ç†å’Œæ¢å¤çš„å…±åŒæ¨¡å¼ã€‚Optionå¹¶ä¸æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨äºæ­¤ç›®çš„çš„å”¯ä¸€æ•°æ®ç±»å‹ï¼Œè™½ç„¶å®ƒç»å¸¸ä½¿ç”¨ï¼Œè€Œä¸”ç›¸å½“ç®€å•ã€‚ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°çš„å…³äºOptionçš„ä¸€ä»¶äº‹æ˜¯ï¼Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶å®ƒä¸ä¼šå‘Šè¯‰æˆ‘ä»¬åˆ°åº•å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚å®ƒæ‰€èƒ½åšçš„å°±æ˜¯ç»™äºˆæˆ‘ä»¬Noneï¼Œè¡¨ç¤ºæ²¡æœ‰ä»»ä½•è®¡ç®—ç»“æœã€‚ä½†æœ‰æ—¶æˆ‘ä»¬æƒ³çŸ¥é“æ›´å¤šã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²æ¥æä¾›æ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ–è€…å½“å¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½è¦çŸ¥é“è¿™ä¸ªé”™è¯¯ç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚

æˆ‘ä»¬å¯ä»¥åˆ¶ä½œä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥åŒ…è£…æˆ‘ä»¬æ‰€å¸Œæœ›çš„å…³äºå¤±è´¥çš„ä»»ä½•ä¿¡æ¯ã€‚æœ‰æ—¶åªçŸ¥é“æ˜¯å¦å‘ç”Ÿå¼‚å¸¸å°±å·²ç»è¶³å¤Ÿäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨Optionï¼›ä½†å…¶ä»–æƒ…å†µæˆ‘ä»¬éœ€è¦æ›´å¤šä¿¡æ¯ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡å¯¹Optionçš„ç®€å•æ‰©å±•ï¼Œå³æ•°æ®ç±»å‹Eitherï¼Œæ¥è®©æˆ‘ä»¬è·Ÿè¸ªå¤±è´¥çš„åŸå› ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å®šä¹‰ï¼š

	sealed trait Either[+E, +A]
	case class Left[+E](value: E) extends Either[E, Nothing]
	case class Right[+A](value: A) extends Either[Nothing, A]


Eitherå’ŒOptionä¸€æ ·åªæœ‰ä¸¤ä¸ªCase Classã€‚æœ¬è´¨åŒºåˆ«åœ¨äºè¿™ä¸¤ç§Case Classéƒ½èƒ½è£…ä¸€ä¸ªå€¼ã€‚Eitheræ•°æ®ç±»å‹ç”¨ä¸€ç§éå¸¸æ™®éçš„æ–¹å¼ä»£è¡¨ä¸¤ç§äº‹ç‰©ä¸­çš„ä¸€ç§ã€‚æˆ‘ä»¬å¯ä»¥è¯´å®ƒæ˜¯ä¸€ä¸ªä¸¤ç§*ä¸ç›¸äº¤ç±»å‹çš„ç»“åˆ*ã€‚å½“æˆ‘ä»¬ç”¨å®ƒæ¥è¡¨ç¤ºæˆåŠŸæˆ–å¤±è´¥æ—¶ï¼ŒæŒ‰æƒ¯ä¾‹ï¼ŒLeftæ„é€ å‡½æ•°è¡¨ç¤ºå¤±è´¥çš„Case[^footnote6]ã€‚

[^footnote6]:Eitherç»å¸¸ç”¨æ¥æ›´æ™®éçš„åŒ…è£…ä¸¤ç§å¯èƒ½æ€§ï¼Œåœ¨ä¸å€¼å¾—å®šä¹‰å‡ºæ–°çš„æ•°æ®ç±»å‹çš„æƒ…å†µä¸‹ã€‚æˆ‘ä»¬å°†åœ¨è¿™æœ¬ä¹¦ä¸­çœ‹åˆ°ä¸€äº›è¿™æ ·çš„ä¾‹å­ã€‚

>ä¾§è¾¹æ ï¼šæ ‡å‡†åº“ä¸­çš„Optionå’ŒEither
>Scalaæ ‡å‡†åº“ä¸­åŒ…å«äº†Optionå’ŒEitherï¼ˆ[Option API](http://www.scala-lang.org/api/current/index.html#scala.Option)å’Œ[Either API](http://www.scala-lang.org/api/current/index.html#scala.util.Either)ï¼‰ï¼Œå¤§å¤šæ•°å‡½æ•°åœ¨æœ¬ç« å®šä¹‰çš„å‡½æ•°éƒ½æœ‰æ ‡å‡†åº“çš„ç‰ˆæœ¬ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›ç¡®å®çš„å‡½æ•°ï¼Œå°¤å…¶æ˜¯sequenceï¼Œ traverseï¼Œå’Œmap2ã€‚
>ä½ æœ€å¥½çœ‹ä¸€ä¸‹Optionå’ŒEitherçš„APIï¼Œè¿™æ ·å°±å¯ä»¥äº†è§£ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚å°¤å…¶æ˜¯Eitherï¼Œå¹¶æ²¡æœ‰æƒ³æˆ‘ä»¬ä¸€æ ·ç›´æ¥å®šä¹‰ä¸€ä¸ªå³åï¼ˆright-biasedï¼‰çš„flatMapå‡½æ•°ï¼Œè€Œæ˜¯ä¾èµ–äºæ¸…æ™°çš„leftå’ŒrightæŠ•å½±å‡½æ•°ï¼ˆprojection functionï¼‰ã€‚ä½ å¯ä»¥ä»APIä¸­å¾—åˆ°æ›´å¤šç»†èŠ‚ã€‚

è®©æˆ‘ä»¬é‡æ–°æ¥çœ‹ä¸€ä¸‹meançš„ä¾‹å­ï¼Œè¿™æ¬¡å½“å¤±è´¥çš„æƒ…å†µä¸‹æˆ‘ä»¬è¿”å›ä¸€ä¸ªStringï¼š

	def mean(xs: IndexedSeq[Double]): Either[String, Double] =
	  if (xs.isEmpty)
	    Left("mean of empty list!")
	  else
	    Right(xs.sum / xs.length)


æœ‰æ—¶æˆ‘ä»¬å¯èƒ½å¸Œæœ›åŒ…å«æ›´å¤šå…³äºè¯¥é”™è¯¯çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å †æ ˆè·Ÿè¸ªè®°å½•æ¥æ˜¾ç¤ºæºä»£ç ä¸­çš„é”™è¯¯çš„ä½ç½®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„åœ¨Leftä¸­è¿”å›ä¸€ä¸ªException:

	def safeDiv(x: Double, y: Double): Either[Exception, Double] =
	  try {
	    Right(x / y)
	  } catch {
	    case e: Exception => Left(e)
	  }


ç»ƒä¹ 7ï¼šåœ¨Eitherä¸­å®ç°mapï¼ŒflatMapï¼ŒorElseï¼Œmap2ï¼Œæ¥æ“ä½œRightçš„å€¼ã€‚

	trait Either[+E, +A] {
	  def map[B](f: A => B): Either[E, B]
	  def flatMap[EE >: E, B](f: A => Either[EE, B]): Either[EE, B]
	  def orElse[EE >: E,B >: A](b: => Either[EE, B]): Either[EE, B]
	  def map2[EE >: E, B, C](b: Either[EE, B])(f: (A, B) => C):
    Either[EE, C]
	}



æ³¨æ„è¿™äº›å‡½æ•°çš„å®šä¹‰ï¼ŒEitherç°åœ¨å¯ä»¥åœ¨for-comprehensionä¸­ä½¿ç”¨äº†ï¼š

	for {
	  age <- Right(42)
	  name <- Left("invalid name")
	  salary <- Right(1000000.0)
	} yield employee(name, age, salary)

è¿™ä¸ªè¡¨è¾¾å¼ä¼šå¾—åˆ°Left("invalid name")ã€‚å½“ç„¶ï¼ŒLeft("invalid name")å¯ä»¥æ˜¯åƒfoo(x,y,z)ä¸€æ ·çš„ä»»æ„è¡¨è¾¾å¼çš„æ‰§è¡ŒLeftç»“æœã€‚

ç»ƒä¹ 8ï¼šåœ¨Eitherä¸­å®ç°sequenceå’Œtraverseã€‚

ä½œä¸ºæœ€ç»ˆçš„ä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸ªä¸€map2çš„åº”ç”¨ï¼Œå‡½æ•°mkPersonä¼šåœ¨æ„å»ºæ­£ç¡®çš„Personå¯¹è±¡å‰éªŒè¯åå­—å’Œå¹´é¾„ï¼š

	case class Person(name: Name, age: Age)
	sealed class Name(val value: String)
	sealed class Age(val value: Int)
	
	def mkName(name: String): Either[String, Name] =
	  if (name == "" || name == null) Left("Name is empty.")
	  else Right(new Name(name))
	  
	def mkAge(age: Int): Either[String, Age] =
	  if (age < 0) Left("Age is out of range.")
	  else Right(new Age(age))
	  
	def mkPerson(name: String, age: Int): Either[String, Person] =
	  mkName(name).map2(mkAge(age))(Person(_, _))

ç»ƒä¹ 9ï¼šä»¥ä¸Šæ˜¯å‡½æ•°çš„å®ç°ï¼Œå³ä½¿åå­—å’Œå¹´é¾„éƒ½ä¸æ­£ç¡®ï¼Œmap2ä¹Ÿåªæ˜¯æ±‡æŠ¥ä¸€ä¸ªé”™è¯¯ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦åŒæ—¶æ±‡æŠ¥ä¸¤ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿä½ ä¼šä¿®æ”¹map2æˆ–æ˜¯mkPersonçš„æ–¹æ³•ç­¾åå—ï¼Ÿè¿˜æ˜¯ä½ ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®ç±»å‹ï¼Œåœ¨æ•è·å¼‚å¸¸è¿™æ–¹é¢æ¯”Eitheråšçš„æ›´å¥½ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›æ–°çš„ç»“æ„å—ï¼ŸorElseï¼Œtraverseå’Œsequenceè¿™ä¸‰ä¸ªå‡½æ•°åœ¨æ–°çš„æ•°æ®ç±»å‹ä¸­æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„è¡Œä¸ºå—ï¼Ÿ

4.4æ€»ç»“
----

ä½¿ç”¨ä»£æ•°æ•°æ®ç±»å‹ï¼Œå¦‚Optionå’ŒEitherï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¨¡å—åŒ–ã€å¯ç»„åˆçš„ã€å®¹æ˜“æ¨å¯¼çš„æ–¹å¼å¤„ç†é”™è¯¯ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¼€å‘äº†ä¸€äº›é«˜é˜¶å‡½æ•°æ¥æ“ä½œé”™è¯¯ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬å°±ä¸å¯èƒ½è¿™æ ·æ“ä½œé”™è¯¯ã€‚æœ‰äº†è¿™äº›æ–°çš„å·¥å…·åœ¨æ‰‹ï¼Œåœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­å¼‚å¸¸åº”è¯¥åªåœ¨çœŸæ­£æ— æ³•å¤åŸçš„æƒ…å†µä¸‹æ‰ä¼šè¢«ä¿ç•™ã€‚

